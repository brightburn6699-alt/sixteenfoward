<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SIXTEEN FORWARD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- WebP preload for critical images -->
<link rel="preload" as="image" href="clothes/caps/blue_panel.webp">
<link rel="preload" as="image" href="clothes/tshirtD1/green_panel.webp">

<style>
:root{
  --neon:#00e1ff;
  --glow:0 0 10px rgba(0,225,255,.6),0 0 20px rgba(0,225,255,.3);
}
*{box-sizing:border-box;margin:0;padding:0}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;
  background:#02050a;
  color:#fff;
  overflow-x:hidden;
}

/* HEADER */
header{
  position:sticky;
  top:0;
  z-index:10;
  padding:15px 20px 15px 60px;
  background:rgba(8,18,36,.9);
  text-align:center;
  will-change:transform;
  backdrop-filter:blur(10px);
}
.brand{
  font-size:20px;
  font-weight:900;
  letter-spacing:2px;
  color:var(--neon);
  text-shadow:var(--glow);
}
.slogan{
  font-size:10px;
  letter-spacing:1px;
  color:#c9f4ff;
}

/* HAMBURGER MENU */
.menu-btn{
  position:absolute;
  left:15px;
  top:50%;
  transform:translateY(-50%);
  width:36px;
  height:36px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  padding:8px;
  background:rgba(0,225,255,0.1);
  border-radius:8px;
  border:1px solid rgba(0,225,255,0.3);
  transition:all 0.3s ease;
  z-index:100;
}
.menu-btn:hover{
  background:rgba(0,225,255,0.2);
  transform:translateY(-50%) scale(1.05);
}
.menu-btn span{
  height:2px;
  width:20px;
  background:var(--neon);
  border-radius:2px;
  transition:all 0.3s ease;
  margin:2px 0;
}
.menu-btn.active span:nth-child(1){
  transform:rotate(45deg) translate(5px,5px);
}
.menu-btn.active span:nth-child(2){
  opacity:0;
}
.menu-btn.active span:nth-child(3){
  transform:rotate(-45deg) translate(7px,-6px);
}

/* SIDE MENU */
.side-menu{
  position:fixed;
  top:0;
  left:-280px;
  width:280px;
  height:100vh;
  background:rgba(8,18,36,0.98);
  backdrop-filter:blur(20px);
  z-index:99;
  transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border-right:1px solid rgba(0,225,255,0.2);
  box-shadow:5px 0 30px rgba(0,0,0,0.5);
  display:flex;
  flex-direction:column;
}
.side-menu.active{
  left:0;
}

.menu-header{
  padding:20px;
  border-bottom:1px solid rgba(0,225,255,0.2);
  background:rgba(0,0,0,0.3);
}
.menu-brand{
  font-size:18px;
  font-weight:900;
  color:var(--neon);
  text-shadow:var(--glow);
  letter-spacing:1px;
}
.menu-close{
  position:absolute;
  top:15px;
  right:15px;
  font-size:30px;
  color:var(--neon);
  cursor:pointer;
  width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  transition:all 0.3s ease;
}
.menu-close:hover{
  background:rgba(0,225,255,0.1);
}

.menu-items{
  padding:20px 0;
  flex:1;
  overflow-y:auto;
}
.menu-items a{
  display:flex;
  align-items:center;
  padding:16px 25px;
  color:#c9f4ff;
  text-decoration:none;
  font-size:15px;
  font-weight:500;
  border-left:4px solid transparent;
  transition:all 0.3s ease;
  margin:5px 0;
}
.menu-items a:hover{
  background:rgba(0,225,255,0.1);
  color:var(--neon);
  border-left-color:var(--neon);
  padding-left:30px;
}
.menu-items a .menu-icon{
  margin-right:12px;
  font-size:18px;
  width:24px;
  text-align:center;
}
.menu-items a.cart-link{
  background:rgba(0,225,255,0.05);
  border:1px solid rgba(0,225,255,0.2);
  border-radius:8px;
  margin:20px 15px;
  padding:15px;
  font-weight:700;
  color:var(--neon);
}

.menu-footer{
  padding:20px;
  border-top:1px solid rgba(0,225,255,0.2);
  font-size:11px;
  color:#7fdfff;
  text-align:center;
}

/* MENU OVERLAY */
.menu-overlay{
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(3px);
  z-index:98;
  opacity:0;
  visibility:hidden;
  transition:all 0.3s ease;
}
.menu-overlay.active{
  opacity:1;
  visibility:visible;
}

/* PRODUCTS */
.products{
  display:flex;
  gap:20px;
  padding:20px 15px 80px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.products::-webkit-scrollbar{display:none}

/* CARD */
.card{
  min-width:85%;
  background:#0c1a34;
  border-radius:20px;
  padding:18px;
  display:flex;
  flex-direction:column;
  flex-shrink:0;
}
.label{
  font-size:11px;
  letter-spacing:1px;
  color:#7fdfff;
}
.price{
  color:var(--neon);
  font-weight:900;
  font-size:18px;
}

/* PRODUCT IMAGE CONTAINER */
.product-image{
  height:320px;
  background:#0a1530;
  border-radius:16px;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:15px;
  margin:12px 0;
  position:relative;
  overflow:hidden;
}

/* Loading animation */
.product-image.loading::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, #0a1530 25%, #0c1a34 50%, #0a1530 75%);
  background-size: 200% 100%;
  animation: shimmer 1s infinite linear;
  opacity: 1;
  z-index: 1;
  border-radius:16px;
}

.product-image img{
  width:auto;
  height:auto;
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  border-radius:12px;
  cursor:pointer;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.product-image img.loaded{
  opacity: 1;
}

@keyframes shimmer {
  0% { background-position: -200px 0; }
  100% { background-position: 200px 0; }
}

/* CAP SPECIFIC STYLES */
.card:first-child .product-image {
  background:#0a1530;
  padding:15px;
}

.card:first-child .product-image img {
  object-fit:contain;
  max-width:100%;
  max-height:100%;
  background:transparent;
}

/* FORM */
select,input{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  background:#0b1e3a;
  border:1px solid #00e1ff55;
  color:#fff;
  font-size:14px;
}
.card button{
  width:100%;
  margin-top:15px;
  padding:14px;
  border:none;
  border-radius:50px;
  background:var(--neon);
  font-weight:900;
  cursor:pointer;
  font-size:15px;
}

/* CORE COLLECTIONS */
.core-title{
  padding:0 15px 10px;
  font-size:20px;
  font-weight:900;
  color:var(--neon);
}
.core-collections{
  display:flex;
  gap:15px;
  padding:0 15px 100px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  scroll-padding: 0 15px;
}
.core-collections::-webkit-scrollbar{display:none}

.core-item {
  min-width:80%;
  flex-shrink:0;
  position:relative;
  border-radius:20px;
  overflow:hidden;
  background:#0a1530;
  display:flex;
  justify-content:center;
  align-items:center;
  height:300px;
}

.core-item img{
  width:auto;
  height:auto;
  max-width:100%;
  max-height:100%;
  border-radius:20px;
  opacity: 0;
  transition: opacity 0.3s ease;
  object-fit: contain;
}

.core-item img.loaded{
  opacity: 1;
}

.core-item.loading::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, #0a1530 25%, #0c1a34 50%, #0a1530 75%);
  background-size: 200% 100%;
  animation: shimmer 1s infinite linear;
  opacity: 1;
  z-index: 1;
  border-radius:20px;
}

/* ORDER BUTTON */
.order-btn{
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
  width:calc(100% - 60px);
  max-width:350px;
  padding:15px;
  border-radius:50px;
  border:none;
  font-weight:900;
  z-index:10;
  cursor:pointer;
  font-size:15px;
}
.order-btn.locked{
  background:#222;
  color:#777;
  pointer-events:none;
}
.order-btn.active{
  background:var(--neon);
  color:#000;
  box-shadow:var(--glow);
}

/* IMAGE VIEWER */
.img-viewer{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
  padding:20px;
}
.img-viewer img{
  width:auto;
  height:auto;
  max-width:90%;
  max-height:80%;
  object-fit:contain;
  border-radius:12px;
  pointer-events:none;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.img-viewer img.loaded{
  opacity: 1;
}

/* CONTROLS */
.img-viewer .close{
  position:absolute;
  top:15px;
  right:20px;
  font-size:30px;
  cursor:pointer;
  color:#fff;
}
.img-viewer .nav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  cursor:pointer;
  color:#fff;
  background:rgba(255,255,255,.1);
  border-radius:50%;
}

.img-viewer .left{left:10px;}
.img-viewer .right{right:10px;}

/* DOTS */
.dots{
  position:absolute;
  bottom:20px;
  display:flex;
  gap:8px;
}
.dot{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#666;
  cursor:pointer;
}
.dot.active{
  background:var(--neon);
}

/* VIEWER-PRICE */
.viewer-price {
  position: absolute;
  bottom: 50px;
  left: 0;
  width: 100%;
  text-align: center;
  font-size: 20px;
  font-weight: 900;
  color: var(--neon);
  z-index: 10;
}

/* CART POPUP */
.cart-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 350px;
  max-height: 70vh;
  background: #0c1e3d;
  border: 1px solid rgba(0, 225, 255, 0.3);
  border-radius: 16px;
  z-index: 100;
  overflow: hidden;
  display:none;
}
.cart-popup.active {
  display:block;
}

.cart-popup-header {
  padding: 15px;
  background: rgba(0, 0, 0, 0.3);
  border-bottom: 1px solid rgba(0, 225, 255, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.cart-popup-title {
  font-size: 18px;
  font-weight: 900;
  color: var(--neon);
}

.cart-close-btn {
  width: 30px;
  height: 30px;
  background: rgba(0, 225, 255, 0.1);
  border: 1px solid rgba(0, 225, 255, 0.3);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 18px;
  color: var(--neon);
}

.cart-items-container {
  max-height: 40vh;
  overflow-y: auto;
  padding: 10px;
}

.cart-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
  background: rgba(11, 30, 58, 0.4);
  border-radius: 12px;
  margin-bottom: 8px;
}

.cart-item-name {
  font-weight: 700;
  color: #fff;
  margin-bottom: 2px;
  font-size: 14px;
}

.cart-item-meta {
  font-size: 11px;
  color: #7fdfff;
}

.cart-item-qty {
  font-size: 12px;
  color: var(--neon);
  margin-top: 2px;
}

.cart-item-price {
  font-weight: 900;
  color: var(--neon);
  margin-left: 10px;
  min-width: 50px;
  text-align: right;
  font-size: 14px;
}

.cart-remove-btn {
  width: 28px;
  height: 28px;
  background: rgba(255, 50, 50, 0.1);
  border: 1px solid rgba(255, 50, 50, 0.3);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  margin-left: 8px;
  color: #ff5555;
  font-size: 16px;
}

.cart-total {
  padding: 15px;
  background: rgba(0, 0, 0, 0.3);
  border-top: 1px solid rgba(0, 225, 255, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.cart-total-label {
  font-size: 16px;
  font-weight: 700;
  color: #fff;
}

.cart-total-amount {
  font-size: 20px;
  font-weight: 900;
  color: var(--neon);
}

.cart-actions {
  padding: 15px;
  display: flex;
  gap: 10px;
}

.cart-action-btn {
  flex: 1;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-weight: 900;
  font-size: 14px;
  cursor: pointer;
}

.cart-action-btn.clear {
  background: rgba(255, 50, 50, 0.1);
  border: 1px solid rgba(255, 50, 50, 0.3);
  color: #ff5555;
}

.cart-action-btn.whatsapp {
  background: #25d366;
  color: white;
}

.cart-empty {
  padding: 30px 15px;
  text-align: center;
  color: #7fdfff;
  font-size: 14px;
}

.cart-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  z-index: 99;
  display: none;
}
.cart-overlay.active {
  display: block;
}

/* CUSTOMER COMMENT */
.customer-comment {
  position: fixed;
  top: 70px;
  right: 10px;
  width: 250px;
  background: rgba(12, 30, 61, 0.95);
  border: 1px solid rgba(0, 225, 255, 0.3);
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(5px);
  z-index: 100;
  display:none;
}
.customer-comment.active {
  display:block;
  animation: slideIn 0.3s ease;
}
@keyframes slideIn {
  from { transform: translateX(100%); opacity:0; }
  to { transform: translateX(0); opacity:1; }
}

.customer-name {
  font-weight: 900;
  color: var(--neon);
  font-size: 14px;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.customer-text {
  font-size: 12px;
  line-height: 1.3;
  color: rgba(210, 230, 255, 0.95);
}

.comment-emoji {
  font-size: 16px;
  margin-left: 6px;
}

.comment-badge {
  background: rgba(0, 225, 255, 0.15);
  border: 1px solid rgba(0, 225, 255, 0.3);
  border-radius: 8px;
  padding: 1px 6px;
  font-size: 8px;
  font-weight: 700;
  color: var(--neon);
  letter-spacing: 0.5px;
}
</style>
</head>

<body>

<header>
  <div class="menu-btn" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <div class="brand">SIXTEEN FORWARD</div>
  <div class="slogan">Forever Forward ‚Äî Backwards Never ‚ùå</div>
</header>

<!-- SIDE MENU -->
<div class="side-menu" id="sideMenu">
  <div class="menu-header">
    <div class="menu-brand">SIXTEEN FORWARD</div>
    <span class="menu-close" onclick="toggleMenu()">√ó</span>
  </div>
  
  <div class="menu-items">
    <a href="index.html">
      <span class="menu-icon">üè†</span> Home
    </a>
    <a href="#products">
      <span class="menu-icon">üëï</span> All Products
    </a>
    <a href="#collections">
      <span class="menu-icon">üé®</span> Collections
    </a>
    <a href="cart.html" class="cart-link" onclick="toggleMenu()">
      <span class="menu-icon">üõí</span> View Cart (<span id="cartCount">0</span>)
    </a>
    <a href="#about">
      <span class="menu-icon">‚ÑπÔ∏è</span> About Us
    </a>
    <a href="#contact">
      <span class="menu-icon">üìû</span> Contact
    </a>
    <a href="#size-guide">
      <span class="menu-icon">üìè</span> Size Guide
    </a>
    <a href="#faq">
      <span class="menu-icon">‚ùì</span> FAQ
    </a>
  </div>
  
  <div class="menu-footer">
    Forever Forward ‚Äî Backwards Never ‚ùå<br>
    ¬© 2024 SIXTEEN FORWARD
  </div>
</div>

<!-- MENU OVERLAY -->
<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

<div class="products" id="products">
  <!-- CAP -->
  <div class="card">
    <div class="label">D1</div>
    <div class="product-image loading">
      <img id="capImg" 
           data-src="clothes/caps/blue_panel.webp"
           loading="lazy" 
           decoding="async"
           alt="Panel Cap - Blue"
           onclick="openViewer(this)">
    </div>
    <div class="price">R150</div>
    <h3>Panel Cap</h3>
    <select class="color" onchange="capImage(this)">
      <option value="blue" selected>Blue</option>
      <option value="black">Black</option>
      <option value="red">Red</option>
      <option value="white">White</option>
    </select>
    <input type="number" class="qty" value="1" min="1">
    <button onclick="addItem('Panel Cap',150,this)">Add to Cart</button>
  </div>

  <!-- T-SHIRT V1 -->
  <div class="card">
    <div class="label">T1</div>
    <div class="product-image loading">
      <img id="teeFront"
           data-src="clothes/tshirtD1/green_panel.webp"
           loading="lazy" 
           decoding="async"
           alt="T-Shirt V1 - Green"
           onclick="openViewer(this)">
    </div>
    <div class="price">R280</div>
    <h3>T-Shirt V1 (300 GSM)</h3>
    <select class="color" onchange="tshirtImage(this)">
      <option value="green" selected>Green</option>
      <option value="black">Black</option>
      <option value="red">Red</option>
      <option value="white">White</option>
    </select>
    <select class="size">
      <option value="M" selected>M</option>
      <option value="S">S</option>
      <option value="L">L</option>
    </select>
    <input type="number" class="qty" value="1" min="1">
    <button onclick="addItem('T-Shirt V1',280,this)">Add to Cart</button>
  </div>

  <!-- T-SHIRT V5 -->
  <div class="card">
    <div class="label">T5</div>
    <div class="product-image loading">
      <img id="teeV5"
           data-src="clothes/tshirtV5/blue_panel.webp"
           loading="lazy" 
           decoding="async"
           alt="T-Shirt V5 - Blue"
           onclick="openViewer(this)">
    </div>
    <div class="price">R280</div>
    <h3>T-Shirt V5 (300 GSM)</h3>
    <select class="color" onchange="tshirtV5Image(this)">
      <option value="blue" selected>Blue</option>
      <option value="black">Black</option>
      <option value="pink">Pink</option>
      <option value="white">White</option>
    </select>
    <select class="size">
      <option value="M" selected>M</option>
      <option value="S">S</option>
      <option value="L">L</option>
    </select>
    <input type="number" class="qty" value="1" min="1">
    <button onclick="addItem('T-Shirt V5',280,this)">Add to Cart</button>
  </div>
</div>

<div class="core-title" id="collections">Core Collections</div>
<div class="core-collections">
  <div class="core-item loading">
    <img data-src="samp/1.webp" loading="lazy" decoding="async" alt="Collection 1">
  </div>
  <div class="core-item loading">
    <img data-src="samp/2.webp" loading="lazy" decoding="async" alt="Collection 2">
  </div>
  <div class="core-item loading">
    <img data-src="samp/3.webp" loading="lazy" decoding="async" alt="Collection 3">
  </div>
  <div class="core-item loading">
    <img data-src="samp/4.webp" loading="lazy" decoding="async" alt="Collection 4">
  </div>
  <div class="core-item loading">
    <img data-src="samp/5.webp" loading="lazy" decoding="async" alt="Collection 5">
  </div>
</div>

<button id="orderBtn" class="order-btn locked" onclick="showCartPopup()">üîí ORDER (LOCKED)</button>

<!-- CART POPUP -->
<div class="cart-overlay" id="cartOverlay" onclick="closeCartPopup()"></div>
<div class="cart-popup" id="cartPopup">
  <div class="cart-popup-header">
    <div class="cart-popup-title">üõí ORDER SUMMARY</div>
    <div class="cart-close-btn" onclick="closeCartPopup()">√ó</div>
  </div>
  
  <div class="cart-items-container" id="cartItemsContainer">
    <!-- Cart items will be dynamically inserted here -->
  </div>
  
  <div class="cart-total">
    <div class="cart-total-label">TOTAL</div>
    <div class="cart-total-amount" id="cartTotalAmount">R0</div>
  </div>
  
  <div class="cart-actions">
    <button class="cart-action-btn clear" onclick="clearCart()">Clear Cart</button>
    <button class="cart-action-btn whatsapp" onclick="confirmOnWhatsApp()">
      üì± WhatsApp
    </button>
  </div>
</div>

<!-- IMAGE VIEWER -->
<div class="img-viewer" id="imgViewer">
  <span class="close" onclick="closeViewer()">√ó</span>
  <span class="nav left" onclick="prevImg()">‚ùÆ</span>
  <img id="viewerImg">
  <div class="viewer-price" id="viewerPrice"></div>
  <span class="nav right" onclick="nextImg()">‚ùØ</span>
  <div class="dots" id="dots"></div>
</div>

<script>
// ==================== MENU FUNCTIONALITY ====================
let isMenuOpen = false;

function toggleMenu() {
  const menu = document.getElementById('sideMenu');
  const overlay = document.getElementById('menuOverlay');
  const menuBtn = document.querySelector('.menu-btn');
  
  isMenuOpen = !isMenuOpen;
  
  if (isMenuOpen) {
    menu.classList.add('active');
    overlay.classList.add('active');
    menuBtn.classList.add('active');
    document.body.style.overflow = 'hidden';
  } else {
    menu.classList.remove('active');
    overlay.classList.remove('active');
    menuBtn.classList.remove('active');
    document.body.style.overflow = '';
  }
}

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && isMenuOpen) {
    toggleMenu();
  }
});

// ==================== FAST WEBP IMAGE LOADING ====================
class FastWebPLoader {
  constructor() {
    this.cache = new Map();
    this.observer = null;
    this.initObserver();
    this.preloadCritical();
  }

  initObserver() {
    if ('IntersectionObserver' in window) {
      this.observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            this.loadImg(entry.target);
            this.observer.unobserve(entry.target);
          }
        });
      }, { rootMargin: '100px' });
    }
  }

  preloadCritical() {
    // Preload first visible images
    const critical = [
      'clothes/caps/blue_panel.webp',
      'clothes/tshirtD1/green_panel.webp',
      'clothes/tshirtV5/blue_panel.webp'
    ];
    
    critical.forEach(src => {
      if (!this.cache.has(src)) {
        const img = new Image();
        img.src = src;
        this.cache.set(src, true);
      }
    });
  }

  loadImg(imgElement) {
    const src = imgElement.dataset.src;
    if (!src) return;
    
    if (this.cache.has(src)) {
      this.applyImg(imgElement, src);
      return;
    }
    
    // Mark as loading
    const container = imgElement.parentElement;
    if (container) container.classList.add('loading');
    
    const img = new Image();
    img.onload = () => {
      this.cache.set(src, true);
      this.applyImg(imgElement, src);
    };
    img.onerror = () => {
      // Fallback to PNG if WebP fails
      const pngSrc = src.replace('.webp', '.png');
      console.warn('WebP failed, trying PNG:', pngSrc);
      this.applyImg(imgElement, pngSrc);
    };
    img.src = src;
  }

  applyImg(imgElement, src) {
    imgElement.onload = () => {
      imgElement.classList.add('loaded');
      const container = imgElement.parentElement;
      if (container) container.classList.remove('loading');
    };
    imgElement.src = src;
  }

  observe(imgElement) {
    if (this.observer) {
      this.observer.observe(imgElement);
    } else {
      this.loadImg(imgElement);
    }
  }
}

const imgLoader = new FastWebPLoader();

// ==================== CART ====================
let cart = [];
let commentTimeout = null;
let isCommentVisible = false;
let currentComment = null;

function loadCart() {
  try {
    cart = JSON.parse(localStorage.getItem('sf_cart') || '[]');
    updateCartCount();
  } catch(e) {
    cart = [];
  }
}

function updateCartCount() {
  const cartCount = document.getElementById('cartCount');
  if (cartCount) {
    let totalItems = 0;
    for (let i = 0; i < cart.length; i++) {
      totalItems += cart[i].qty;
    }
    cartCount.textContent = totalItems;
  }
}

// ==================== CUSTOMER COMMENTS ====================
const CUSTOMER_COMMENTS = [
  {name:"Angie", text:"White cap le blue V5 tshirt üî•", emoji:" "},
  {name:"Sbuda ", text:"Angie lapho ukhuluma nge outfit yama bozza ü´¥üî•", emoji:""},
  {name:"Lindiweü©∑", text:"yooh leskipa esi red t-shirt v1 si sharpüíØ‚ù§Ô∏è", emoji:""},
  {name:"Bontle", text:"3rd purchase quality is'khona straight üèÜ", emoji:""},
  {name:"King Maps", text:" delivery infact leh service yenu üî• üëë!", emoji:"üëë"},
  {name:"Sindy", text:"Aweh ama hoodie... pleaz ama hoodieü§≤", emoji:"üîÑ"},
  {name:"T-Boz", text:"strong Quality üòé", emoji:"üéØ"},
  {name:"T-Boz", text:"Cela ningithengeleni le white V5 ü´¥üòÜ", emoji:""},
  {name:"Gigi", text:" bona lesikipa esi Blue üò≠üíô!", emoji:""},
  {name:"Zee", text:" sengimele ama hoodie manje !", emoji:""},
  {name:"Lelo", text:"Endless combinations for ama gents üåà!", emoji:""},
  {name:"Nkosi", text:"Red cap straight fire for braai days ü•©üî•", emoji:""},
  {name:"Thando", text:"Black V1 Tshirt  üíº‚ú®", emoji:""},
  {name:"DJ Sphe", text:" blue cap  yashaya straight üîä", emoji:""},
  {name:"Mama Joy", text:"Great Quality üíØ", emoji:""},
  {name:"Leo", text:" i love your brand guys , keep it up  üëö!", emoji:"üöÄ"},
  {name:"Palesa", text:"Waiting for my shipping to arrive‚ù§Ô∏è", emoji:"üöö"},
  {name:"Ayanda", text:"matching outfit ne boyfriend yam , üë©‚Äç‚ù§Ô∏è‚Äçüë®", emoji:"‚ù§Ô∏è"},
  {name:"Langa", text:" real quality siyibona khona lah üåü", emoji:"üåü"},
  {name:"Zinhle", text:"sengi funa lesi esi Pink manje , sengikhathele esi black‚ù§Ô∏è üò≠", emoji:""},
  {name:"Bheki", text:" ngihleka laba abazonda le brand ü§£üò≠ü§£ü§£", emoji:""},
  {name:"Nadia", text:"Shout to the founder of this brand!", emoji:""},
  {name:"TK", text:" 2026 is welcoming us with sixteenforward , dankoüíØüòé!", emoji:"üíØ"},
  {name:"Refilwe", text:"Birthday gift for my man . angisaliüéÅ", emoji:"üéÇ"},
  {name:"Vuyo", text:"best local brand so far‚ú®!", emoji:""},
  {name:"Amanda", text:"Ordered Thursday was rocking Friday night ‚ö°", emoji:""},
  {name:"Siya", text:"Even my My Dad asked where I got it üíß", emoji:""},
  {name:"Nomsa", text:" guys please add new colours üî• ", emoji:""},
  {name:"Lwazi", text:"Perfect for weekends around Daveyton chill üèñÔ∏è", emoji:""},
  {name:"Thabiso", text:"Stitching iholding up in kasi life üëå", emoji:""},
  {name:"Zanele", text:"no more basic clothing sibalanda nge sixteen ‚ôªÔ∏è!", emoji:"üåç"},
  {name:"Zanele", text:"sesi shoda ngama Hoodie ü©∑", emoji:"üåç"},
  {name:"Nomsa", text:"asinga thola ama hoodie singaba sharpüôè", emoji:""},
  {name:"Lelo", text:"stay tuned bazosithengisela nama underwearü©≤ü§£", emoji:"üåà"},
  {name:"Zinhle", text:"Lelo ubhemile nerhü§£üò≠!?", emoji:"ü§£"},
  {name:"Neo", text: "Nah guys, black is still the best. It goes with everything üñ§", emoji: ""},
  {name:"Kamo", text: "Black is safe, but that blue one hits different üíô", emoji: ""},
  {name:"Buhle", text: "White looks clean when it‚Äôs fresh ü§ç", emoji: ""},
  {name:"Thuso", text: "White is risky though, one stain and it‚Äôs over üòÇ", emoji: ""},
  {name:"Mpho", text: " bese kuba khona laba aba zonda this brand üò≠ü§£ü§£", emoji: "üòéüíØ"},
  {name:"Jabu", text: "You guys are sleeping on grey, it‚Äôs lowkey clean üå´Ô∏è", emoji: ""},
  {name:"Rico", text: "Grey is cool, but blue stands out more üëÄ", emoji: ""},
  {name:"Neo", text: "Blue gets attention, but black feels premium ‚ú®", emoji: ""},
  {name:"Buhle", text: "True, black works everywhere üëå", emoji: ""},
  {name:"Kamo", text: "Kanti ama hoodie bawa faka nini? Kuyabanda manje ü•∂", emoji: ""},
  {name:"Thuso", text: "today beng ringa no Sabelo uthi soon bazo dropa ama hoodie", emoji: "üîú"},
  {name:"Mpho", text: "Once those hoodies drop, black is selling out first üî•", emoji: ""},
  {name:"Rico", text: "Khona othi ufuna leh Tshirt eh greenüíö", emoji: ""},
  {name:"Jabu", text: "Same here, especially if they drop grey üëï", emoji: ""},
  {name:"Buhle", text: "Blue hoodie would be crazy though üòÆ‚Äçüí®", emoji: ""},
  {name:"Neo", text: "Either way, Sixteen is doing its thing üíØ", emoji: ""},
  {name:"Kamo", text: " Honestly guys this is the best brand üöÄ", emoji: ""}
];

function showCustomerComment() {
  if (isCommentVisible || !document.body) return;
  
  if (currentComment) {
    currentComment.remove();
    currentComment = null;
  }
  
  const comment = CUSTOMER_COMMENTS[Math.floor(Math.random() * CUSTOMER_COMMENTS.length)];
  const commentEl = document.createElement('div');
  commentEl.className = 'customer-comment';
  commentEl.innerHTML = `
    <div class="customer-name">
      <span>${comment.name} <span class="comment-badge">CUSTOMER</span></span>
      <span class="comment-emoji">${comment.emoji}</span>
    </div>
    <div class="customer-text">${comment.text}</div>
  `;
  
  document.body.appendChild(commentEl);
  currentComment = commentEl;
  isCommentVisible = true;
  
  setTimeout(() => commentEl.classList.add('active'), 10);
  
  commentTimeout = setTimeout(() => {
    if (commentEl && commentEl.parentNode) {
      commentEl.classList.remove('active');
      setTimeout(() => {
        if (commentEl && commentEl.parentNode) {
          commentEl.remove();
          currentComment = null;
          isCommentVisible = false;
          commentTimeout = setTimeout(showCustomerComment, 5000 + Math.random() * 10000);
        }
      }, 300);
    }
  }, 6000);
}

// ==================== CART FUNCTIONS ====================
function addItem(name, price, btn) {
  const card = btn.parentElement;
  const color = card.querySelector('.color').value;
  const sizeEl = card.querySelector('.size');
  const size = sizeEl ? sizeEl.value : '';
  const qty = parseInt(card.querySelector('.qty').value) || 1;

  if (!color) return alert('Select color');
  if (sizeEl && !size) return alert('Select size');

  let item = cart.find(i => i.name === name && i.color === color && i.size === size);
  
  if (item) {
    item.qty += qty;
  } else {
    cart.push({
      name, price, color, size, qty,
      id: Date.now() + Math.random()
    });
  }
  
  saveCart();
  alert('Added to cart!');
}

function saveCart() {
  try {
    localStorage.setItem('sf_cart', JSON.stringify(cart));
  } catch(e) {
    // Keep in memory only if localStorage fails
  }
  updateOrderButton();
  updateCartCount();
}

function updateOrderButton() {
  const orderBtn = document.getElementById('orderBtn');
  if (!orderBtn) return;
  
  if (!cart.length) {
    orderBtn.textContent = 'üîí ORDER (LOCKED)';
    orderBtn.className = 'order-btn locked';
    return;
  }
  
  let items = 0, total = 0;
  for (let i = 0; i < cart.length; i++) {
    items += cart[i].qty;
    total += cart[i].price * cart[i].qty;
  }
  
  orderBtn.textContent = `ORDER (${items}) ¬∑ R${total}`;
  orderBtn.className = 'order-btn active';
}

// ==================== IMAGE SWITCH FUNCTIONS ====================
function capImage(sel) {
  const capImg = document.getElementById('capImg');
  if (!capImg) return;
  
  const container = capImg.parentElement;
  container.classList.add('loading');
  capImg.classList.remove('loaded');
  
  const newSrc = `clothes/caps/${sel.value}_panel.webp`;
  capImg.dataset.src = newSrc;
  
  imgLoader.loadImg(capImg);
}

function tshirtImage(sel) {
  const teeFront = document.getElementById('teeFront');
  if (!teeFront) return;
  
  const container = teeFront.parentElement;
  container.classList.add('loading');
  teeFront.classList.remove('loaded');
  
  const newSrc = `clothes/tshirtD1/${sel.value}_panel.webp`;
  teeFront.dataset.src = newSrc;
  
  imgLoader.loadImg(teeFront);
}

function tshirtV5Image(sel) {
  const teeV5 = document.getElementById('teeV5');
  if (!teeV5) return;
  
  const container = teeV5.parentElement;
  container.classList.add('loading');
  teeV5.classList.remove('loaded');
  
  const newSrc = `clothes/tshirtV5/${sel.value}_panel.webp`;
  teeV5.dataset.src = newSrc;
  
  imgLoader.loadImg(teeV5);
}

// ==================== IMAGE VIEWER ====================
let viewerImages = [];
let viewerIndex = 0;

function openViewer(imgElement) {
  const card = imgElement.closest('.card');
  const price = card.querySelector('.price').textContent;
  const mainImg = imgElement.src;
  const colorSelect = card.querySelector('.color');
  const currentColor = colorSelect ? colorSelect.value : '';
  
  if (mainImg.includes('clothes/caps/')) {
    viewerImages = [mainImg];
  } else if (mainImg.includes('clothes/tshirtV5/') && currentColor) {
    viewerImages = [mainImg, mainImg.replace('clothes/tshirtV5/', 'clothes/tshirtV5/back_')];
  } else if (mainImg.includes('clothes/tshirtD1/') && currentColor) {
    viewerImages = [mainImg, mainImg.replace('clothes/tshirtD1/', 'clothes/tshirtD1/back_')];
  } else {
    alert('Please select a color first');
    return;
  }
  
  viewerIndex = 0;
  const viewerPrice = document.getElementById('viewerPrice');
  if (viewerPrice) viewerPrice.textContent = price;
  
  updateViewer();
  
  const imgViewer = document.getElementById('imgViewer');
  const viewerImg = document.getElementById('viewerImg');
  if (imgViewer && viewerImg) {
    viewerImg.classList.remove('loaded');
    imgViewer.style.display = 'flex';
  }
}

function updateViewer() {
  const viewerImg = document.getElementById('viewerImg');
  const dots = document.getElementById('dots');
  
  if (viewerImg) {
    viewerImg.classList.remove('loaded');
    viewerImg.src = viewerImages[viewerIndex];
    viewerImg.onload = () => {
      viewerImg.classList.add('loaded');
    };
  }
  
  if (!dots) return;
  
  while (dots.firstChild) {
    dots.removeChild(dots.firstChild);
  }
  
  if (viewerImages.length > 1) {
    for (let i = 0; i < viewerImages.length; i++) {
      const dot = document.createElement('div');
      dot.className = i === viewerIndex ? 'dot active' : 'dot';
      dot.onclick = () => { viewerIndex = i; updateViewer(); };
      dots.appendChild(dot);
    }
    dots.style.display = 'flex';
    const navs = document.querySelectorAll('.img-viewer .nav');
    if (navs[0]) navs[0].style.display = 'flex';
    if (navs[1]) navs[1].style.display = 'flex';
  } else {
    dots.style.display = 'none';
    const navs = document.querySelectorAll('.img-viewer .nav');
    if (navs[0]) navs[0].style.display = 'none';
    if (navs[1]) navs[1].style.display = 'none';
  }
}

function closeViewer() {
  const imgViewer = document.getElementById('imgViewer');
  if (imgViewer) imgViewer.style.display = 'none';
}

function nextImg() {
  viewerIndex = (viewerIndex + 1) % viewerImages.length;
  updateViewer();
}

function prevImg() {
  viewerIndex = (viewerIndex - 1 + viewerImages.length) % viewerImages.length;
  updateViewer();
}

// ==================== CART POPUP ====================
function showCartPopup() {
  if (!cart.length) return;
  
  const container = document.getElementById('cartItemsContainer');
  const totalAmount = document.getElementById('cartTotalAmount');
  const overlay = document.getElementById('cartOverlay');
  const popup = document.getElementById('cartPopup');
  
  if (!container || !totalAmount || !overlay || !popup) return;
  
  container.innerHTML = '';
  
  let total = 0;
  
  for (let i = 0; i < cart.length; i++) {
    const item = cart[i];
    const itemTotal = item.price * item.qty;
    total += itemTotal;
    
    const cartItem = document.createElement('div');
    cartItem.className = 'cart-item';
    cartItem.innerHTML = `
      <div class="cart-item-details">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-meta">
          ${item.color}${item.size ? ` ‚Ä¢ ${item.size}` : ''}
        </div>
        <div class="cart-item-qty">Qty: ${item.qty}</div>
      </div>
      <div class="cart-item-price">R${itemTotal}</div>
      <div class="cart-remove-btn" onclick="removeCartItem(${i})">√ó</div>
    `;
    container.appendChild(cartItem);
  }
  
  totalAmount.textContent = `R${total}`;
  overlay.classList.add('active');
  popup.classList.add('active');
}

function closeCartPopup() {
  const overlay = document.getElementById('cartOverlay');
  const popup = document.getElementById('cartPopup');
  if (overlay) overlay.classList.remove('active');
  if (popup) popup.classList.remove('active');
}

function removeCartItem(index) {
  if (confirm('Remove this item from cart?')) {
    cart.splice(index, 1);
    saveCart();
    showCartPopup();
    updateOrderButton();
  }
}

function clearCart() {
  if (confirm('Clear entire cart?')) {
    cart = [];
    saveCart();
    closeCartPopup();
    updateOrderButton();
  }
}

// ==================== WHATSAPP ====================
function confirmOnWhatsApp() {
  if (!cart.length) return;
  
  let items = 0, total = 0;
  let orderDetails = "üõí *SIXTEEN FORWARD ORDER*\n\n";
  
  for (let i = 0; i < cart.length; i++) {
    const item = cart[i];
    items += item.qty;
    total += item.price * item.qty;
    orderDetails += `*${i + 1}. ${item.name}*\n`;
    orderDetails += `Color: ${item.color}\n`;
    if (item.size) orderDetails += `Size: ${item.size}\n`;
    orderDetails += `Qty: ${item.qty}\n`;
    orderDetails += `Price: R${item.price * item.qty}\n\n`;
  }
  
  orderDetails += `*TOTAL ITEMS:* ${items}\n`;
  orderDetails += `*TOTAL AMOUNT:* R${total}\n\n`;
  
  cart = [];
  saveCart();
  updateOrderButton();
  closeCartPopup();
  
  const whatsappNumber = "+27782250532";
  const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(orderDetails)}`;
  window.open(whatsappURL, '_blank');
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', function() {
  loadCart();
  updateOrderButton();
  
  // Load all images
  const allImages = document.querySelectorAll('img[data-src]');
  allImages.forEach(img => {
    if (img.id === 'capImg' || img.id === 'teeFront' || img.id === 'teeV5') {
      imgLoader.loadImg(img);
    } else {
      imgLoader.observe(img);
    }
  });
  
  // Preload other color variants
  setTimeout(() => {
    ['black', 'red', 'white', 'green', 'pink'].forEach(color => {
      // Just cache the paths, don't actually load
      imgLoader.cache.set(`clothes/caps/${color}_panel.webp`, false);
      imgLoader.cache.set(`clothes/tshirtD1/${color}_panel.webp`, false);
      imgLoader.cache.set(`clothes/tshirtV5/${color}_panel.webp`, false);
    });
  }, 1000);
  
  setTimeout(showCustomerComment, 8000);
});

// Clean up
window.addEventListener('beforeunload', function() {
  if (commentTimeout) clearTimeout(commentTimeout);
  if (currentComment && currentComment.parentNode) {
    currentComment.remove();
  }
  viewerImages = [];
});
</script>

</body>
</html>